<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>××ª×’×¨ ×”××”× ×“×¡: ×©×‘×¨×™× ×•××™×œ×™× â›ï¸</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* --- ×¤×•× ×˜×™× --- */
        @font-face {
            font-family: 'Minecraft';
            src: url('https://raw.githubusercontent.com/TiagoVignatti/Minecraft-Font/master/minecraft_font.ttf') format('truetype');
        }
        @font-face {
            font-family: 'Impact';
            src: local('Impact'), local('Impact-Regular'), url(https://fonts.gstatic.com/l/font?kit=__impact_kit_placeholder__);
        }

        /* --- Global Reset & Body --- */
        body {
            font-family: 'Minecraft', 'Courier New', monospace; 
            margin: 0;
            padding: 0;
            color: #FFF; 
            direction: rtl;
            text-align: right;
            height: 100vh;
            width: 100vw;
            overflow: hidden; 
            display: flex;
            align-items: center;
            justify-content: center;
            image-rendering: pixelated;
            background-color: #87CEEB; 
            transition: background-color 5s ease;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        /* --- 3D WORLD BACKGROUND & ENVIRONMENT --- */
        #world-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0; perspective: 600px; overflow: hidden;
            background: linear-gradient(to bottom, #87CEEB 0%, #C8EAFF 60%, #E0F7FA 100%);
            transition: background 30s ease-in-out; /* ××¢×‘×¨ ××¨×•×š */
        }

        #world-layer.night { background: linear-gradient(to bottom, #000033 0%, #191970 60%, #483D8B 100%); }
        #world-layer.storm { background: linear-gradient(to bottom, #2C3E50 0%, #4A5866 100%); }

        /* Celestial Bodies */
        .sun {
            position: absolute; top: 10%; left: 10%; width: 60px; height: 60px;
            background-color: #FFF500; box-shadow: 4px 4px 0 rgba(0,0,0,0.1);
            z-index: 1; transition: top 30s ease-in-out, left 30s ease-in-out, opacity 5s ease; /* ××¢×‘×¨ ××¨×•×š */
        }
        @media (min-width: 768px) { .sun { width: 80px; height: 80px; } }
        
        .moon {
            position: absolute; top: 110%; left: 80%; width: 50px; height: 50px;
            background-color: #F4F6F0; box-shadow: 0 0 10px rgba(255,255,255,0.5);
            z-index: 1; transition: top 30s ease-in-out, opacity 5s ease; /* ××¢×‘×¨ ××¨×•×š */
        }
        @media (min-width: 768px) { .moon { width: 60px; height: 60px; } }
        .moon::after { content: ''; position: absolute; top: 8px; left: 8px; width: 8px; height: 8px; background: #DDD; opacity: 0.5; }

        .star {
            position: absolute; width: 3px; height: 3px; background: white; opacity: 0;
            transition: opacity 5s ease; /* ××¢×‘×¨ ××¨×•×š */
        }
        #world-layer.night .star { opacity: 0.8; animation: twinkle 2s infinite alternate; }
        @keyframes twinkle { 0% { opacity: 0.3; } 100% { opacity: 1; } }

        /* Weather: Rain */
        .rain-drop {
            position: absolute; width: 2px; height: 15px; background: rgba(200, 200, 255, 0.6);
            top: -20px; z-index: 5; animation: fall 0.5s linear infinite; display: none;
        }
        #world-layer.raining .rain-drop { display: block; }
        @keyframes fall { to { transform: translateY(105vh); } }

        .cloud {
            position: absolute; background-color: rgba(255,255,255,0.8);
            width: 100px; height: 30px; z-index: 2;
            box-shadow: 6px 6px 0 rgba(0,0,0,0.05);
            animation: moveCloud linear infinite; transition: background-color 5s; /* ××¢×‘×¨ ××¨×•×š */
        }
        #world-layer.storm .cloud { background-color: #555; box-shadow: 4px 4px 0 #222; }
        .cloud::after {
            content: ''; position: absolute; top: -15px; left: 15px;
            width: 70px; height: 15px; background-color: inherit;
        }

        .ground-plane {
            position: absolute; bottom: -200px; left: -100%; width: 300%; height: 100%;
            background-color: #5C9338;
            background-image: linear-gradient(rgba(0,0,0,0.1) 2px, transparent 2px), linear-gradient(90deg, rgba(0,0,0,0.1) 2px, transparent 2px);
            background-size: 40px 40px;
            transform: rotateX(60deg) translateZ(-50px); transform-origin: 50% 100%;
            z-index: 3; animation: moveGround 4s linear infinite;
            box-shadow: inset 0 100px 100px rgba(135, 206, 235, 0.5);
            transition: box-shadow 30s ease-in-out, background-color 30s ease-in-out; /* ××¢×‘×¨ ××¨×•×š */
        }
        @media (min-width: 768px) { .ground-plane { background-size: 60px 60px; } }
        #world-layer.night .ground-plane { background-color: #2E4B1C; box-shadow: inset 0 100px 100px rgba(0, 0, 50, 0.8); }

        @keyframes moveGround { 0% { background-position: 0 0; } 100% { background-position: 0 60px; } }
        @keyframes moveCloud { 0% { transform: translateX(110vw); } 100% { transform: translateX(-20vw); } }
        @keyframes sunFloat { 0% { transform: translateY(0); } 100% { transform: translateY(-10px); } }

        /* --- TOWER SCENERY STYLES --- */
        #scenery-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 4;
            transform-style: preserve-3d; perspective: 600px; overflow: hidden;
        }
        .tower-stack {
            position: absolute; display: flex; flex-direction: column-reverse;
            align-items: center; transform-origin: center bottom;
            animation: moveTower 10s linear infinite;
        }
        .tower-block {
            width: 30px; height: 30px;
            background-image: url('https://static.wikia.nocookie.net/minecraft_gamepedia/images/c/c5/Grass_Block_JE7_BE6.png');
            background-size: cover; image-rendering: pixelated;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
        }
        @media (min-width: 768px) { .tower-block { width: 50px; height: 50px; } }
        @keyframes moveTower {
            0% { top: 40%; opacity: 0; transform: scale(0.2); }
            10% { opacity: 1; }
            100% { top: 120%; opacity: 1; transform: scale(1.5); }
        }

        /* --- CINEMATIC INTRO STYLES --- */
        #cinematic-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #000; z-index: 9999;
            display: flex; align-items: center; justify-content: center;
            overflow: hidden; flex-direction: column;
        }
        .lightning-flash {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #FFF; opacity: 0; pointer-events: none; z-index: 100;
        }

        /* Silhouette Enderman */
        .intro-enderman {
            position: relative; width: 80px; height: 130px;
            transform-origin: center bottom; opacity: 0; z-index: 101;
        }
        @media (min-width: 768px) { .intro-enderman { width: 120px; height: 200px; } }
        
        .intro-enderman .ender-head, .intro-enderman .ender-body,
        .intro-enderman .ender-arm, .intro-enderman .ender-leg {
            background-color: #000 !important; box-shadow: 0 0 5px rgba(0,0,0,0.5);
        }
        .intro-enderman .ender-eye {
            background: #D57DFF !important; box-shadow: 0 0 15px #D57DFF, 0 0 5px #FFF !important;
        }
        .intro-running { animation: runToCamera 3s ease-in forwards; }

        @keyframes runToCamera {
            0% { transform: scale(0.2) translateY(50px); opacity: 0; }
            5% { opacity: 1; }
            100% { transform: scale(8) translateY(40px); opacity: 1; }
        }
        @media (min-width: 768px) {
            @keyframes runToCamera {
                0% { transform: scale(0.2) translateY(50px); opacity: 0; }
                5% { opacity: 1; }
                100% { transform: scale(12) translateY(80px); opacity: 1; }
            }
        }

        @keyframes flashLightning {
            0% { opacity: 0; } 2% { opacity: 1; } 4% { opacity: 0; } 6% { opacity: 0.5; }
            8% { opacity: 0; } 20% { opacity: 0; } 22% { opacity: 0.8; } 24% { opacity: 0; }
            50% { opacity: 0; } 52% { opacity: 1; } 54% { opacity: 0.2; } 56% { opacity: 0; }
            80% { opacity: 0; } 82% { opacity: 0.6; } 84% { opacity: 0; } 100% { opacity: 0; }
        }
        @keyframes aggressiveShake {
            0% { transform: rotate(0deg); } 25% { transform: rotate(5deg); } 75% { transform: rotate(-5deg); } 100% { transform: rotate(0deg); }
        }
        .anim-running .arm-l { animation: runArm 0.3s infinite alternate !important; }
        .anim-running .arm-r { animation: runArm 0.3s infinite alternate-reverse !important; }
        .anim-running .leg-l { animation: runLeg 0.3s infinite alternate !important; }
        .anim-running .leg-r { animation: runLeg 0.3s infinite alternate-reverse !important; }
        .anim-running .ender-head { animation: aggressiveShake 0.5s infinite !important; }
        @keyframes runArm { from { transform: rotate(45deg); } to { transform: rotate(-45deg); } }
        @keyframes runLeg { from { transform: translateY(-5px); } to { transform: translateY(5px); } }

        .mega-title {
            font-size: 4rem; line-height: 1; text-align: center; font-weight: 900; 
            color: #FFD700; font-family: 'Impact', 'Arial Black', sans-serif;
            letter-spacing: 2px; -webkit-text-stroke: 2px #000;
            text-shadow: 0 1px 0 #c6a300, 0 2px 0 #c6a300, 0 3px 0 #c6a300, 0 4px 0 #000, 5px 5px 10px rgba(0,0,0,0.5);
            animation: flashColors 0.3s infinite alternate; transform: perspective(500px) rotateX(15deg); max-width: 90vw;
        }
        @media (min-width: 768px) {
            .mega-title {
                font-size: 8rem; letter-spacing: 4px; -webkit-text-stroke: 4px #000;
                text-shadow: 0 1px 0 #c6a300, 0 2px 0 #c6a300, 0 3px 0 #c6a300, 0 4px 0 #c6a300, 0 5px 0 #c6a300, 0 6px 0 #c6a300, 0 7px 0 #c6a300, 0 8px 0 #c6a300, 0 9px 0 #000, 0 10px 0 #000, 10px 10px 20px rgba(0,0,0,0.5);
            }
        }
        @keyframes flashColors {
            0% { color: #FF0000; text-shadow: 0 4px 0 #8B0000; }
            25% { color: #00FF00; text-shadow: 0 4px 0 #006400; }
            50% { color: #0000FF; text-shadow: 0 4px 0 #00008B; }
            75% { color: #FFFF00; text-shadow: 0 4px 0 #8B8B00; }
            100% { color: #FF00FF; text-shadow: 0 4px 0 #8B008B; }
        }

        /* --- UI --- */
        .ui-layer {
            position: relative; z-index: 10; width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center; padding: 0.5rem; pointer-events: none;
        }
        .mc-gui-container {
            pointer-events: auto; background-color: rgba(198, 198, 198, 0.95);
            border: 4px solid #000; box-shadow: inset 4px 4px 0 #FFF, inset -4px -4px 0 #555, 0 20px 50px rgba(0,0,0,0.5);
            padding: 12px; color: #3F3F3F; width: 95%; max-width: 900px; max-height: 95vh; overflow-y: auto; position: relative; border-radius: 4px;
        }
        .mc-slot {
            background-color: #8B8B8B; border-right: 2px solid #FFF; border-bottom: 2px solid #FFF;
            border-left: 2px solid #373737; border-top: 2px solid #373737; padding: 8px; 
            display: flex; align-items: center; justify-content: center; box-shadow: inset 2px 2px 0 #000;
        }
        .btn-mc {
            border: 2px solid #000; box-shadow: inset 2px 2px 0 rgba(255,255,255,0.4), inset -2px -2px 0 rgba(0,0,0,0.4);
            color: #FFF; text-shadow: 2px 2px 0 #000; font-weight: bold; padding: 12px 16px; cursor: pointer; text-align: center;
            display: inline-flex; align-items: center; justify-content: center; gap: 6px; font-size: 1rem; touch-action: manipulation; user-select: none;
        }
        .btn-mc:active { transform: translateY(2px); box-shadow: inset 2px 2px 0 rgba(0,0,0,0.4); }
        .btn-mc:disabled { background-color: #555 !important; color: #888; cursor: not-allowed; filter: grayscale(100%); }
        .btn-stone { background-color: #757575; color: #FFF; }
        .btn-grass { background-color: #4A8F28; }
        .btn-diamond { background-color: #3C8DAB; }
        .btn-gold { background-color: #F0A804; color: #000; text-shadow: none; }
        .btn-redstone { background-color: #AA0000; }
        .btn-obsidian { background-color: #141019; border-color: #633196; }
        .btn-wood { background-color: #8F6942; }
        .btn-command { background-color: #C77E4F; border-color: #965F37; } 
        .mc-input {
            background-color: #222; color: #FFF; border: 2px solid #555; padding: 8px; font-family: inherit; text-align: center; font-size: 16px; box-shadow: inset 2px 2px 0 #000;
        }
        .mc-input:focus { border-color: #FFF; background-color: #000; outline: none; }
        .question-box {
            background-color: #4A4A4A; border: 3px solid #222; padding: 12px; margin-bottom: 15px; color: #FFF; text-align: center; font-size: 1.1rem;
            text-shadow: 2px 2px 0 #000; box-shadow: inset 0 0 10px #000; width: 100%;
        }
        @media (min-width: 768px) { .question-box { font-size: 1.3rem; padding: 15px; } }

        .block-row {
            display: flex; gap: 4px; justify-content: center; align-items: flex-end; background: rgba(0,0,0,0.2); padding: 10px;
            border-radius: 4px; border: 2px solid rgba(0,0,0,0.5); min-height: 50px; flex-wrap: wrap;
        }
        .mc-block-img {
            width: 32px; height: 32px; image-rendering: pixelated; filter: drop-shadow(2px 2px 0px rgba(0,0,0,0.5)); transition: transform 0.2s;
        }
        @media (min-width: 768px) { .mc-block-img { width: 48px; height: 48px; filter: drop-shadow(4px 4px 0px rgba(0,0,0,0.5)); } }
        .mc-block-img:hover { transform: translateY(-5px); }
        .mc-block-ghost { opacity: 0.3; filter: grayscale(100%) brightness(0.5); }
        .pie-chart {
            width: 80px; height: 80px; border-radius: 50%; border: 4px solid #5C4033; background-color: #222; position: relative; box-shadow: 2px 2px 5px rgba(0,0,0,0.5);
        }
        @media (min-width: 768px) { .pie-chart { width: 100px; height: 100px; } }

        :root {
            --color-grass: #4A8F28; --color-stone: #7D7D7D; --color-diamond: #3C8DAB; --color-gold: #F0A804;
            --color-iron: #E6E6E6; --color-tnt: #DB2E23; --color-wood: #8F6942; --color-emerald: #17DD62;
            --color-coal: #333; --color-cake: #FFF;
        }
        .filled-answer { display: inline-block; padding: 0 4px; border-bottom-width: 3px; font-weight: bold; transition: all 0.3s ease; }
        .filled-correct { color: #4ade80; border-color: #4ade80; }
        .filled-wrong { color: #fb923c; border-color: #fb923c; }

        /* Enderman Styles */
        .enderman-scene { position: relative; width: 80px; height: 130px; margin: 0 auto 10px; }
        @media (min-width: 768px) { .enderman-scene { width: 120px; height: 200px; margin: 0 auto 20px; } }
        .ender-head { width: 33%; height: 17.5%; background: #000; position: absolute; top: 0; left: 33%; z-index: 10; animation: floatHead 4s ease-in-out infinite; }
        .ender-eye { width: 25%; height: 11%; background: #D57DFF; position: absolute; top: 50%; box-shadow: 0 0 5px #D57DFF; }
        .eye-l { left: 10%; } .eye-r { right: 10%; }
        .ender-body { width: 21%; height: 35%; background: #000; position: absolute; top: 17.5%; left: 39%; z-index: 5; }
        .ender-arm { width: 5%; height: 55%; background: #000; position: absolute; top: 19%; transform-origin: top center; }
        .arm-l { left: 31%; transform: rotate(3deg); animation: swayArm 3s infinite alternate; }
        .arm-r { right: 31%; transform: rotate(-3deg); animation: swayArm 3s infinite alternate-reverse; }
        .ender-leg { width: 5%; height: 50%; background: #000; position: absolute; top: 50%; }
        .leg-l { left: 40%; } .leg-r { right: 40%; }
        .particle { width: 4px; height: 4px; background: #D57DFF; position: absolute; opacity: 0; animation: portal 2s infinite; }
        @keyframes floatHead { 0%,100%{top:0;} 50%{top:-3px;} }
        @keyframes swayArm { 0%{transform:rotate(3deg);} 100%{transform:rotate(-3deg);} }
        @keyframes portal { 0% {transform:translate(0,0) scale(1); opacity:1;} 100% {transform:translate(var(--tx), var(--ty)) scale(0); opacity:0;} }

        .hidden { display: none !important; }
        .fraction-divider { height: 3px; background: #FFF; margin: 4px 0; box-shadow: 1px 1px 0 #000; }
        .inline-icon { display: inline-block; vertical-align: middle; width: 24px; height: 24px; margin: 0 2px; filter: drop-shadow(2px 2px 0 rgba(0,0,0,0.5)); }
        @media (min-width: 768px) { .inline-icon { width: 32px; height: 32px; margin: 0 4px; } }

        .log-table { border-collapse: separate; border-spacing: 0; width: 100%; }
        .log-table th { background-color: #2d2d2d; border-bottom: 2px solid #555; padding: 6px; font-size: 0.9rem; }
        .log-table td { padding: 6px; border-bottom: 1px solid #444; font-size: 0.9rem; }
        .log-table tr:nth-child(even) { background-color: rgba(255, 255, 255, 0.05); }
        
        .wizard-section { background-color: #3b2e25; border: 2px solid #5e4b35; padding: 10px; margin-bottom: 10px; border-radius: 4px; }
        .wizard-title { color: #d1b588; font-weight: bold; font-size: 1.1rem; margin-bottom: 5px; display: flex; align-items: center; gap: 8px; }
        .wizard-content { color: #ddd; font-size: 0.95rem; line-height: 1.4; }
    </style>
</head>
<body>

    <!-- Sounds -->
    <audio id="bg-music" loop>
        <source src="https://raw.githubusercontent.com/orengamchi/etai_shvarim-/main/%D7%90%D7%99%D7%AA%D7%99%20%D7%A9%D7%91%D7%A8%D7%99%D7%9D.mp3" type="audio/mpeg">
    </audio>
    <audio id="sfx-thunder" preload="auto">
        <source src="https://upload.wikimedia.org/wikipedia/commons/e/e0/Thunder_sound_effect.ogg" type="audio/ogg">
    </audio>

    <!-- CINEMATIC INTRO OVERLAY -->
    <div id="cinematic-overlay" class="z-[100]">
        <div id="start-btn-container" class="absolute z-50 text-center w-full px-4">
            <h1 class="text-4xl md:text-6xl text-white mb-6 font-bold" style="text-shadow: 4px 4px #AA0000;">âš ï¸ ××–×”×¨×”</h1>
            <button onclick="playIntro()" class="btn-mc btn-obsidian text-xl md:text-3xl p-6 md:p-8 border-purple-500 animate-pulse w-full max-w-md">
                ×œ×—×¥ ×œ×”×¤×¢×œ×ª ×”××¢×¨×›×ª
            </button>
        </div>
        
        <!-- INTRO PART 1: Enderman -->
        <div id="intro-animation" class="hidden w-full h-full relative flex items-center justify-center">
            <div class="lightning-flash"></div>
            
            <div id="scary-enderman" class="intro-enderman anim-running">
                <div class="ender-head"><div class="ender-eye eye-l"></div><div class="ender-eye eye-r"></div></div>
                <div class="ender-body"></div>
                <div class="ender-arm arm-l"></div><div class="ender-arm arm-r"></div>
                <div class="ender-leg leg-l"></div><div class="ender-leg leg-r"></div>
            </div>
        </div>

        <!-- INTRO PART 2: Title -->
        <div id="intro-title" class="hidden w-full h-full relative flex items-center justify-center p-4">
            <div class="mega-title">
                ×©×™×¢×•×¨×™<br>×‘×™×ª
            </div>
        </div>
    </div>

    <!-- 3D WORLD LAYER -->
    <div id="world-layer">
        <!-- Celestial Bodies -->
        <div class="sun"></div>
        <div class="moon"></div>
        <div id="stars-container"></div>
        
        <!-- Clouds -->
        <div class="cloud" style="top: 15%; left: -20%; animation-duration: 25s;"></div>
        <div class="cloud" style="top: 25%; left: -40%; animation-duration: 35s; transform: scale(0.8);"></div>
        <div class="cloud" style="top: 10%; left: -10%; animation-duration: 45s; transform: scale(1.2);"></div>
        
        <!-- Rain -->
        <div id="rain-container"></div>
        
        <!-- Ground and Towers -->
        <div class="ground-plane"></div>
        <div id="scenery-layer"></div>
    </div>

    <!-- UI LAYER -->
    <div class="ui-layer">
        <div class="mc-gui-container hidden" id="main-interface">
            
            <!-- Top Bar -->
            <div class="flex flex-col md:flex-row justify-between items-center mb-2 md:mb-4 border-b-2 border-gray-500 pb-2 gap-2">
                <div class="flex gap-2">
                    <button onclick="showHome()" class="btn-mc btn-redstone" title="×—×–×¨×” ×œ××¡×š ×”×¨××©×™">ğŸ  ×‘×™×ª</button>
                    <button onclick="showAdminPanel()" class="btn-mc btn-command text-black" title="×”×¢×œ××ª ×©××œ×•×ª">ğŸ–¥ï¸ Uploader</button>
                    <button id="music-btn" onclick="toggleMusic()" class="btn-mc btn-stone">ğŸµ × ×’×Ÿ</button>
                    <!-- Spellbook Icon Button (Consistent on all pages) -->
                    <button onclick="showContextualHelp()" class="btn-mc btn-obsidian text-purple-300 border-purple-500 p-2" title="×¡×¤×¨ ×”××›×©×£ (×¢×–×¨×”)">
                        <img src="https://static.wikia.nocookie.net/minecraft_gamepedia/images/7/7b/Book_JE2_BE2.png" width="24" height="24">
                    </button>
                </div>
                
                <div class="flex gap-4 bg-gray-800 px-4 py-2 border-2 border-white rounded text-white shadow-lg">
                    <span class="border-l border-white pl-4 ml-2">â­ ×¦×™×•×Ÿ ×›×œ×œ×™: <span id="score-display" class="text-yellow-400 font-bold text-xl">0</span></span>
                    <span>ğŸ’ ×™×”×œ×•××™×: <span id="diamonds-display" class="text-cyan-400 font-bold text-xl">0</span></span>
                </div>
                
                <div>
                      <select id="difficulty-select" class="mc-input text-sm p-1" onchange="changeDifficulty()">
                        <option value="easy">ğŸŒ² ×§×œ</option>
                        <option value="medium" selected>â›ï¸ ×‘×™× ×•× ×™</option>
                        <option value="hard">ğŸ—¡ï¸ ×§×©×”</option>
                    </select>
                </div>
            </div>

            <!-- VIEWS -->

            <!-- 0. Intro View (Menu) -->
            <div id="intro-view" class="view flex flex-col items-center justify-center py-4 md:py-10 text-center h-full overflow-y-auto">
                <div class="enderman-scene">
                    <div class="ender-head"><div class="ender-eye eye-l"></div><div class="ender-eye eye-r"></div></div>
                    <div class="ender-body"></div>
                    <div class="ender-arm arm-l"></div><div class="ender-arm arm-r"></div>
                    <div class="ender-leg leg-l"></div><div class="ender-leg leg-r"></div>
                    <div class="particle" style="top:50%; left:20%; --tx: -20px; --ty: -20px;"></div>
                    <div class="particle" style="top:30%; right:20%; --tx: 20px; --ty: -30px; animation-delay: 0.5s;"></div>
                </div>

                <h1 class="text-4xl font-bold mb-8 text-purple-800" style="text-shadow: 2px 2px #FFF;">×”××ª×’×¨ ×©×œ ×”×× ×“×¨××Ÿ</h1>
                <p class="mb-6 text-gray-700 font-bold">×”×©×œ× ××ª ×”××©×™××•×ª ×›×“×™ ×œ×‘× ×•×ª ×¤×•×¨×˜×œ!</p>
                <button onclick="startGame()" class="btn-mc btn-grass text-2xl px-12 py-4 shadow-lg">×”×ª×—×œ ××©×—×§ â–¶</button>
            </div>

            <!-- 1. Subject Menu -->
            <div id="subject-menu-view" class="view hidden text-center h-full overflow-y-auto">
                <h2 class="text-2xl mb-8 text-gray-800">×‘×—×¨ ××ª ×”××›×¨×” ×©×œ×š:</h2>
                <div class="flex flex-col sm:flex-row justify-center gap-6">
                    <button onclick="showView('math-menu-view')" class="btn-mc btn-wood text-xl p-8 w-64 flex flex-col items-center gap-2">
                        <span class="text-4xl">ğŸ”¢</span>
                        <span>×¢×•×œ× ×”×©×‘×¨×™×</span>
                    </button>
                    <button onclick="showView('english-menu-view')" class="btn-mc btn-diamond text-xl p-8 w-64 flex flex-col items-center gap-2 text-black" style="text-shadow:none">
                        <span class="text-4xl">ğŸ“œ</span>
                        <span>×¢×•×œ× ×”××™×œ×™×</span>
                    </button>
                </div>
                <div class="mt-8">
                    <button onclick="showTips()" class="btn-mc btn-obsidian text-purple-300 border-purple-500">ğŸ’¡ ×¡×¤×¨ ×”×›×©×¤×™× (×˜×™×¤×™×)</button>
                </div>
            </div>

            <!-- 2. Math Menu -->
            <div id="math-menu-view" class="view hidden h-full overflow-y-auto pb-4">
                <h2 class="text-2xl mb-4 text-center text-gray-800">××©×™××•×ª ×›×¨×™×™×” (×—×©×‘×•×Ÿ):</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <button onclick="startMission(1)" class="btn-mc btn-stone text-lg text-right px-4">1. ğŸŒ² ××œ××™ ×”×ª×™×‘×” (×–×™×”×•×™)</button>
                    <button onclick="startMission(2)" class="btn-mc btn-stone text-lg text-right px-4">2. ğŸ—¿ ××™×•×Ÿ ×‘×œ×•×§×™× (×¡×•×’×™×)</button>
                    <button onclick="startMission(3)" class="btn-mc btn-stone text-lg text-right px-4">3. ğŸ§± ×©×•×œ×—×Ÿ ×”×™×¦×™×¨×” (×—×™×‘×•×¨)</button>
                    <button onclick="startMission(4)" class="btn-mc btn-stone text-lg text-right px-4">4. âš–ï¸ ×××–× ×™ ×”×›×•×— (×”×©×•×•××”)</button>
                    <button onclick="startMission(5)" class="btn-mc btn-gold text-lg text-right px-4">5. ğŸ² ×”×›×¤×¨ ×•×”××©×§ (××™×œ×•×œ×™×•×ª)</button>
                </div>
            </div>

            <!-- 3. English Menu -->
            <div id="english-menu-view" class="view hidden h-full overflow-y-auto pb-4">
                <h2 class="text-2xl mb-4 text-center text-gray-800">××©×™××•×ª ×©×¤×” (×× ×’×œ×™×ª):</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <button onclick="startMission(101)" class="btn-mc btn-stone text-lg text-right px-4">E1. ğŸ·ï¸ Inventory Sort (Vocab)</button>
                    <button onclick="startMission(102)" class="btn-mc btn-stone text-lg text-right px-4">E2. âœ… Steve's Actions (To Be)</button>
                    <button onclick="startMission(103)" class="btn-mc btn-stone text-lg text-right px-4">E3. ğŸ§­ Steve's Journal (Reading)</button>
                </div>
            </div>

            <!-- 4. Game Arena -->
            <div id="game-view" class="view hidden h-full flex flex-col">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="mission-title" class="text-xl font-bold text-gray-700">××©×™××”</h3>
                    <div class="flex gap-2 items-center">
                        <span class="text-gray-600 font-bold">×©××œ×” <span id="q-num">1</span></span>
                    </div>
                </div>

                <!-- Progress Bar -->
                <div class="w-full mb-6">
                    <div class="w-full h-6 bg-gray-900 border-2 border-black relative overflow-hidden">
                        <div id="progress-fill" class="h-full bg-green-500 transition-all duration-500 ease-out" style="width: 0%; box-shadow: inset 0 -2px 0 rgba(0,0,0,0.3);"></div>
                    </div>
                </div>

                <div class="question-box">
                    <p id="question-text">×”×©××œ×” ×ª×•×¤×™×¢ ×›××Ÿ...</p>
                </div>

                <div id="game-content" class="mb-6 min-h-[150px] flex flex-col items-center justify-center gap-4">
                    <!-- Dynamic Content -->
                </div>

                <div class="flex justify-center gap-4 flex-wrap mt-4">
                    <button onclick="prevQ()" class="btn-mc btn-stone">â¬…ï¸ ×”×§×•×“×</button>
                    <button onclick="checkAnswer()" id="check-btn" class="btn-mc btn-grass text-xl px-8">×‘×“×•×§! â›ï¸</button>
                    <button onclick="skipQ()" id="skip-btn" class="btn-mc btn-gold">×“×œ×’ â©</button>
                </div>

                <div id="feedback" class="hidden mt-4 p-4 border-2 border-white text-center font-bold text-xl" style="background:#333;"></div>
            </div>

            <!-- 5. Summary -->
            <div id="summary-view" class="view hidden text-center p-8 h-full overflow-y-auto">
                <h2 class="text-4xl mb-6 text-green-600" style="text-shadow: 2px 2px #FFF">×¡×™×•× ×›×¨×™×™×”!</h2>
                <div class="bg-gray-300 border-4 border-black p-6 mb-6 inline-block min-w-[300px]">
                    <div class="text-4xl mb-4 font-bold text-blue-800">×¦×™×•×Ÿ ××©×™××”: <span id="final-grade">100%</span></div>
                    <div class="text-xl text-black border-t border-gray-500 pt-2">
                        <p>×¡×”"×› × ×™×§×•×“ ×›×œ×œ×™: <span id="final-score">0</span></p>
                        <p>×¡×”"×› ×™×”×œ×•××™×: <span id="final-diamonds">0</span> ğŸ’</p>
                    </div>
                </div>
                
                <!-- Direct Next Mission Button -->
                <div id="next-level-container" class="hidden mb-6">
                    <button onclick="goToNextMission()" class="btn-mc btn-grass w-full py-4 text-2xl shadow-xl animate-bounce">
                        ×”××©×™××” ×”×‘××” â­ï¸
                    </button>
                </div>

                <div id="retake-section" class="hidden mb-6">
                    <p class="text-red-600 font-bold mb-2 text-xl">× ××¦××• ×¤×¨×™×˜×™× ×¤×’×•××™× (×˜×¢×•×™×•×ª)!</p>
                    <button onclick="startReview()" class="btn-mc btn-obsidian text-purple-300 border-purple-500 w-full py-4 text-xl animate-pulse">
                        â™»ï¸ ××‘×—×Ÿ ×—×•×–×¨ (×ª×§×Ÿ ×˜×¢×•×™×•×ª)
                    </button>
                </div>

                <div class="text-right mb-6">
                    <h3 class="text-xl mb-2 text-gray-700">×™×•××Ÿ ×—×¤×™×¨×•×ª (×˜×¢×•×™×•×ª):</h3>
                    <div class="bg-gray-800 border-2 border-white p-2 h-48 overflow-y-auto">
                        <table class="log-table text-sm text-white">
                            <thead><tr class="border-b border-gray-600"><th>×©××œ×”</th><th>×ª×©×•×‘×” × ×›×•× ×”</th></tr></thead>
                            <tbody id="error-log-body"></tbody>
                        </table>
                        <p id="no-errors-text" class="hidden text-center text-green-400 mt-4 font-bold text-lg">×¢×‘×•×“×” ××•×©×œ××ª! ××™×Ÿ ×ª×§×œ×•×ª ×‘××›×¨×”.</p>
                    </div>
                </div>
                
                <button onclick="showHome()" class="btn-mc btn-wood w-full py-3">×—×–×¨×” ×œ××—× ×” ğŸ </button>
            </div>

        </div>
    </div>

    <!-- Tips Modal (Spellbook) -->
    <div id="tips-modal" class="hidden fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50">
        <div class="bg-gray-200 border-4 border-black p-6 max-w-2xl w-full relative text-black h-[80vh] overflow-y-auto" style="background: #c6c6c6;">
            <button onclick="hideTips()" class="absolute top-2 left-2 font-bold text-red-600 text-xl btn-mc btn-stone">X ×¡×’×•×¨</button>
            
            <div class="text-center mb-6">
                <h3 class="text-3xl font-bold mb-2" style="color: #3f3f3f; text-shadow: 2px 2px #fff;">ğŸ“– ×¡×¤×¨ ×”××›×©×£</h3>
                <p class="text-gray-700 font-bold">××“×¨×™×š ××¡×˜×¨×˜×’×™ ×œ×¤×ª×¨×•×Ÿ ×‘×¢×™×•×ª</p>
            </div>

            <div id="tips-content">
                <!-- Dynamic Content Will Be Injected Here -->
            </div>
        </div>
    </div>

    <!-- Admin / Uploader Modal -->
    <div id="admin-panel-modal" class="hidden fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50">
        <div class="bg-orange-200 border-4 border-orange-900 p-6 max-w-2xl w-full relative text-black h-[550px] flex flex-col font-mono" style="background-color: #C77E4F; border-color: #5C3A21;">
            <button onclick="hideAdminPanel()" class="absolute top-2 left-2 font-bold text-red-900 text-xl">X</button>
            
            <div class="flex items-center justify-center gap-3 mb-4">
                <span class="text-4xl">ğŸ–¥ï¸</span>
                <h3 class="text-2xl font-bold text-center text-white drop-shadow-md">Command Block: Uploader</h3>
            </div>
            
            <p class="text-sm text-center mb-4 text-white font-bold bg-black bg-opacity-20 p-2 rounded">
                ×”×›× ×¡ ×¤×§×•×“×•×ª JSON ×›×“×™ ×œ×˜×¢×•×Ÿ ×©××œ×•×ª ×—×“×©×•×ª ×œ×¢×•×œ×.
            </p>
            
            <textarea id="json-input" class="flex-grow p-4 font-mono text-sm border-4 border-orange-800 bg-black text-green-400 mb-4 rounded shadow-inner" 
            placeholder='[
  { 
    "missionId": 1, 
    "q": "×©××œ×” ×—×“×©×”...", 
    "n": 1, "d": 2, 
    "type": "M_ID", 
    "theme": "diamond" 
  }
]'></textarea>
            
            <div class="flex gap-4">
                <button onclick="loadCustomQuestions()" class="btn-mc btn-green flex-1 shadow-lg">Load Data (×˜×¢×Ÿ)</button>
                <button onclick="clearCustomQuestions()" class="btn-mc btn-red flex-1 shadow-lg">Reset World (× ×§×”)</button>
            </div>
            <p id="admin-feedback" class="text-center mt-2 font-bold text-white"></p>
        </div>
    </div>

    <script>
        // --- Global State ---
        const MAX_QUESTIONS = 15;
        let gameState = {
            score: 0,
            diamonds: 0,
            difficulty: 'medium',
            missionId: 0,
            history: [],
            historyIndex: -1,
            errors: [], // Stores full question objects for retake
            isReview: false,
            missionScore: 0,
            questionQueue: [] // Queue for shuffling unique questions
        };

        // --- ICON SYSTEM ---
        const ITEM_ICONS = {
            // Original Set
            diamond: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/9/90/Diamond_JE3_BE3.png",
            gold: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/3/3a/Gold_Ingot_JE4_BE2.png",
            iron: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/f/fc/Iron_Ingot_JE3_BE2.png",
            emerald: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/2/26/Emerald_JE3_BE3.png",
            tnt: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/7/72/TNT_JE3.png",
            wood: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/a/a2/Oak_Log_JE5_BE3.png",
            stone: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/d/d4/Cobblestone_JE5_BE3.png",
            coal: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/2/29/Coal_JE4_BE3.png",
            apple: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/a/af/Apple_JE3_BE3.png",
            cake: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/c/c2/Cake_JE4.png",
            potion: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/9/9f/Potion_of_Swiftness_JE2_BE2.png",
            sword: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/8/8e/Iron_Sword_JE2_BE2.png",
            armor: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/2/22/Diamond_Chestplate_JE3_BE3.png",
            creeper: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/6/6d/Creeper_Head_JE3_BE3.png",
            enderman: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/a/a0/Enderman_Head_8-bit.png",
            zombie: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/f/f8/Zombie_Head_JE3_BE3.png",
            ladder: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/a/a3/Ladder_JE3_BE2.png",
            crafting: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/b/b5/Crafting_Table_JE4_BE3.png",
            
            // --- NEW: Tools ---
            pickaxe: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/c/c4/Diamond_Pickaxe_JE3_BE3.png",
            axe: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/4/47/Diamond_Axe_JE3_BE3.png",
            shovel: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/1/14/Diamond_Shovel_JE3_BE3.png",
            hoe: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/9/90/Diamond_Hoe_JE3_BE3.png",
            fishing_rod: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/7/7f/Fishing_Rod_JE2_BE2.png",
            clock: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/6/62/Clock_JE3.gif",
            compass: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/f/f6/Compass_JE3_BE3.gif",
            shears: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/3/30/Shears_JE2_BE2.png",
            flint_and_steel: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/2/2f/Flint_and_Steel_JE4_BE2.png",

            // --- NEW: Armor ---
            helmet: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/2/22/Iron_Helmet_JE2_BE2.png",
            chestplate: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/7/7c/Iron_Chestplate_JE2_BE2.png",
            leggings: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/3/3d/Iron_Leggings_JE2_BE2.png",
            boots: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/8/80/Iron_Boots_JE2_BE2.png",

            // --- NEW: Food ---
            bread: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/9/94/Bread_JE2_BE2.png",
            carrot: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/4/4e/Carrot_JE2_BE2.png",
            porkchop: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/3/30/Raw_Porkchop_JE2_BE2.png",
            cooked_porkchop: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/3/3d/Cooked_Porkchop_JE2_BE2.png",
            fish: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/1/18/Cod_JE3_BE2.png",
            cookie: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/b/b3/Cookie_JE2_BE2.png",
            melon: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/d/db/Melon_Slice_JE2_BE2.png",
            steak: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/8/8e/Steak_JE4_BE3.png",
            chicken_cooked: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/6/62/Cooked_Chicken_JE3_BE3.png",
            potato: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/c/c3/Potato_JE3_BE3.png",
            pumpkin_pie: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/6/6c/Pumpkin_Pie_JE2_BE2.png",
            golden_apple: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/6/64/Golden_Apple_JE2_BE2.png",

            // --- NEW: Resources ---
            stick: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/7/7a/Stick_JE1_BE1.png",
            bone: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/9/9d/Bone_JE3_BE2.png",
            string: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/9/9d/String_JE1_BE1.png",
            feather: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/9/91/Feather_JE1_BE1.png",
            wheat: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/e/e2/Wheat_JE2_BE2.png",
            seeds: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/4/4b/Wheat_Seeds_JE1_BE1.png",
            leather: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/1/10/Leather_JE1_BE1.png",
            paper: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/9/97/Paper_JE1_BE1.png",
            book: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/7/7b/Book_JE2_BE2.png",
            brick: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/5/53/Brick_JE2_BE2.png",
            glowstone_dust: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/8/87/Glowstone_Dust_JE2_BE2.png",
            redstone: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/d/d5/Redstone_Dust_JE2_BE2.png",

            // --- NEW: Transport & Misc ---
            minecart: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/e/ea/Minecart_JE4_BE2.png",
            boat: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/c/c4/Oak_Boat_JE4_BE2.png",
            saddle: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/2/23/Saddle_JE2_BE2.png",
            ender_pearl: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/f/f6/Ender_Pearl_JE3_BE2.png",
            eye_of_ender: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/7/7a/Eye_of_Ender_JE2_BE2.png",
            music_disc: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/6/65/Music_Disc_13_JE2_BE2.png",
            bucket_water: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/c/c5/Water_Bucket_JE2_BE2.png",
            bucket_lava: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/2/27/Lava_Bucket_JE2_BE2.png",
            bucket_milk: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/2/22/Milk_Bucket_JE2_BE2.png",
            
            // --- NEW: Weaponry (Bow/Arrow) ---
            bow: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/a/a5/Bow_JE2_BE1.png",
            arrow: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/4/4e/Arrow_JE2_BE1.png",
            
            // --- FULL TOOLSETS ---
            sword_wood: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/d/d5/Wooden_Sword_JE2_BE2.png",
            sword_stone: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/b/b1/Stone_Sword_JE2_BE2.png",
            sword_iron: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/8/8e/Iron_Sword_JE2_BE2.png",
            sword_gold: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/d/d7/Golden_Sword_JE2_BE2.png",
            sword_diamond: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/6/6a/Diamond_Sword_JE2_BE2.png",
            sword_netherite: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/d/d5/Netherite_Sword_JE2_BE2.png",

            pickaxe_wood: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/a/a2/Wooden_Pickaxe_JE3_BE3.png",
            pickaxe_stone: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/c/c4/Stone_Pickaxe_JE2_BE2.png",
            pickaxe_iron: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/d/d1/Iron_Pickaxe_JE3_BE2.png",
            pickaxe_gold: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/e/e0/Golden_Pickaxe_JE3_BE2.png",
            pickaxe_diamond: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/c/c4/Diamond_Pickaxe_JE3_BE3.png",
            pickaxe_netherite: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/5/54/Netherite_Pickaxe_JE2_BE2.png",

            axe_wood: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/5/5b/Wooden_Axe_JE2_BE2.png",
            axe_stone: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/1/1d/Stone_Axe_JE2_BE2.png",
            axe_iron: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/3/3d/Iron_Axe_JE2_BE2.png",
            axe_gold: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/5/54/Golden_Axe_JE2_BE2.png",
            axe_diamond: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/4/47/Diamond_Axe_JE3_BE3.png",
            axe_netherite: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/a/a8/Netherite_Axe_JE2_BE2.png",

            shovel_wood: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/b/b8/Wooden_Shovel_JE2_BE2.png",
            shovel_stone: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/6/6a/Stone_Shovel_JE2_BE2.png",
            shovel_iron: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/2/27/Iron_Shovel_JE2_BE2.png",
            shovel_gold: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/9/9b/Golden_Shovel_JE2_BE2.png",
            shovel_diamond: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/1/14/Diamond_Shovel_JE3_BE3.png",
            shovel_netherite: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/3/36/Netherite_Shovel_JE2_BE2.png",

            hoe_wood: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/2/23/Wooden_Hoe_JE2_BE2.png",
            hoe_stone: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/2/29/Stone_Hoe_JE2_BE2.png",
            hoe_iron: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/a/a8/Iron_Hoe_JE2_BE2.png",
            hoe_gold: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/3/3c/Golden_Hoe_JE2_BE2.png",
            hoe_diamond: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/9/90/Diamond_Hoe_JE3_BE3.png",
            hoe_netherite: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/5/56/Netherite_Hoe_JE2_BE2.png",

            // --- FULL ARMOR SETS ---
            helmet_leather: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/1/1a/Leather_Cap_JE4_BE2.png",
            helmet_chain: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/0/0f/Chainmail_Helmet_JE2_BE2.png",
            helmet_iron: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/2/22/Iron_Helmet_JE2_BE2.png",
            helmet_gold: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/b/b2/Golden_Helmet_JE2_BE2.png",
            helmet_diamond: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/0/0a/Diamond_Helmet_JE2_BE2.png",
            helmet_netherite: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/2/2f/Netherite_Helmet_JE2_BE2.png",

            chestplate_leather: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/b/b7/Leather_Tunic_JE4_BE2.png",
            chestplate_chain: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/9/98/Chainmail_Chestplate_JE2_BE2.png",
            chestplate_iron: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/7/7c/Iron_Chestplate_JE2_BE2.png",
            chestplate_gold: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/0/07/Golden_Chestplate_JE2_BE2.png",
            chestplate_diamond: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/2/22/Diamond_Chestplate_JE3_BE3.png",
            chestplate_netherite: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/5/56/Netherite_Chestplate_JE2_BE2.png",

            leggings_leather: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/1/10/Leather_Pants_JE4_BE2.png",
            leggings_chain: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/8/84/Chainmail_Leggings_JE2_BE2.png",
            leggings_iron: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/3/3d/Iron_Leggings_JE2_BE2.png",
            leggings_gold: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/0/07/Golden_Leggings_JE2_BE2.png",
            leggings_diamond: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/e/e1/Diamond_Leggings_JE2_BE2.png",
            leggings_netherite: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/0/06/Netherite_Leggings_JE3_BE2.png",

            boots_leather: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/1/12/Leather_Boots_JE2_BE2.png",
            boots_chain: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/f/f5/Chainmail_Boots_JE2_BE2.png",
            boots_iron: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/8/80/Iron_Boots_JE2_BE2.png",
            boots_gold: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/5/52/Golden_Boots_JE2_BE2.png",
            boots_diamond: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/b/bd/Diamond_Boots_JE2_BE2.png",
            boots_netherite: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/9/9b/Netherite_Boots_JE2_BE2.png",

            // Basic aliases for backward compatibility
            pickaxe: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/c/c4/Diamond_Pickaxe_JE3_BE3.png",
            axe: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/4/47/Diamond_Axe_JE3_BE3.png",
            shovel: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/1/14/Diamond_Shovel_JE3_BE3.png",
            hoe: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/9/90/Diamond_Hoe_JE3_BE3.png",
            clock: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/6/62/Clock_JE3.gif",
            compass: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/f/f6/Compass_JE3_BE3.gif",
            shears: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/3/30/Shears_JE2_BE2.png",
            flint_and_steel: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/2/2f/Flint_and_Steel_JE4_BE2.png",
            fishing_rod: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/7/7f/Fishing_Rod_JE2_BE2.png"
        };
        
        // 3D Blocks/Items for the visualizer
        const THEME_BLOCKS = {
            grass: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/c/c5/Grass_Block_JE7_BE6.png",
            stone: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/d/d4/Cobblestone_JE5_BE3.png",
            diamond: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/c/c8/Block_of_Diamond_JE5_BE3.png",
            gold: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/9/93/Block_of_Gold_JE6_BE3.png",
            iron: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/3/36/Block_of_Iron_JE4_BE3.png",
            tnt: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/7/72/TNT_JE3.png",
            wood: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/a/a2/Oak_Log_JE5_BE3.png",
            emerald: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/0/0b/Block_of_Emerald_JE4_BE3.png",
            coal: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/a/a3/Block_of_Coal_JE3_BE2.png",
            cake: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/c/c2/Cake_JE4.png",
            
            // NEW BLOCKS
            netherrack: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/d/d4/Netherrack_JE4_BE2.png",
            sand: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/b/bb/Sand_JE6_BE3.png",
            end_stone: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/0/05/End_Stone_JE3_BE2.png",
            planks_oak: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/c/c1/Oak_Planks_JE6_BE3.png",
            ore_coal: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/2/2f/Coal_Ore_JE4_BE3.png",
            ore_iron: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/5/55/Iron_Ore_JE5_BE4.png",
            ore_gold: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/8/81/Gold_Ore_JE5_BE3.png",
            ore_diamond: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/9/9b/Diamond_Ore_JE4_BE4.png",
            brick: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/5/53/Brick_JE2_BE2.png",
            wool_white: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/8/86/White_Wool_JE3_BE2.png",

            // Mapped Items for Visuals
            bread: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/9/94/Bread_JE2_BE2.png",
            cookie: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/b/b3/Cookie_JE2_BE2.png",
            redstone: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/d/d5/Redstone_Dust_JE2_BE2.png",
            porkchop: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/3/30/Raw_Porkchop_JE2_BE2.png",
            cooked_porkchop: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/3/3d/Cooked_Porkchop_JE2_BE2.png",
            bucket_water: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/c/c5/Water_Bucket_JE2_BE2.png",
            bucket_lava: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/2/27/Lava_Bucket_JE2_BE2.png",
            bucket_milk: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/2/22/Milk_Bucket_JE2_BE2.png",
            fish: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/1/18/Cod_JE3_BE2.png",
            carrot: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/4/4e/Carrot_JE2_BE2.png",
            melon: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/d/db/Melon_Slice_JE2_BE2.png",
            pickaxe: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/c/c4/Diamond_Pickaxe_JE3_BE3.png",
            axe: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/4/47/Diamond_Axe_JE3_BE3.png",
            shovel: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/1/14/Diamond_Shovel_JE3_BE3.png",
            hoe: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/9/90/Diamond_Hoe_JE3_BE3.png",
            fishing_rod: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/7/7f/Fishing_Rod_JE2_BE2.png",
            clock: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/6/62/Clock_JE3.gif",
            compass: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/f/f6/Compass_JE3_BE3.gif"
        };

        const ANSWER_DISPLAY_MAP = {
            "proper": "×§×˜×Ÿ ×-1", "improper": "×’×“×•×œ ×-1", "verb": "×¤×•×¢×œ (Verb)", "adj": "×ª×•××¨ (Adjective)",
            "calendar": "×–××Ÿ (Calendar)", "number": "××¡×¤×¨ (Number)", "am": "am", "is": "is", "are": "are",
            "<": "< (×§×˜×Ÿ ×)", ">": "> (×’×“×•×œ ×)", "=": "= (×©×•×•×”)"
        };

        // --- Wizard Hints ---
        const HINTS = {
            "M_ID": `<div class="wizard-section"><div class="wizard-title"><span class="text-2xl">ğŸ”¢</span> ×–×™×”×•×™ ×©×‘×¨×™×</div><div class="wizard-content"><p>×›×“×™ ×œ××¦×•× ××ª ×”×©×‘×¨:</p><ul class="list-disc pr-5"><li><strong>×”××•× ×” (×œ××¢×œ×”):</strong> ×¡×¤×•×¨ ×¤×¨×™×˜×™× <u>××œ××™×</u>.</li><li><strong>×”××›× ×” (×œ××˜×”):</strong> ×¡×¤×•×¨ ××ª <u>×›×œ</u> ×”×¤×¨×™×˜×™×.</li></ul></div></div>`,
            "M_WORD": `<div class="wizard-section"><div class="wizard-title"><span class="text-2xl">ğŸ“œ</span> ×‘×¢×™×” ××™×œ×•×œ×™×ª</div><div class="wizard-content"><ul class="list-disc pr-5"><li>"× ×©××¨×•" = ×—×™×¡×•×¨ (-).</li><li>"×¡×š ×”×›×œ" = ×—×™×‘×•×¨ (+).</li><li>"×—×œ×§ ×..." = ×›×¤×œ (×œ××©×œ: 1/4 ×-12 = 12/4).</li></ul></div></div>`,
            "M_SORT": `<div class="wizard-section"><div class="wizard-title"><span class="text-2xl">âš–ï¸</span> ×¡×•×’×™ ×©×‘×¨×™×</div><div class="wizard-content"><ul class="list-disc pr-5"><li><strong>×§×˜×Ÿ ×-1:</strong> ××•× ×” < ××›× ×”.</li><li><strong>×’×“×•×œ/×©×•×•×” ×œ-1:</strong> ××•× ×” >= ××›× ×”.</li></ul></div></div>`,
            "M_CMP": `<div class="wizard-section"><div class="wizard-title"><span class="text-2xl">ğŸ†š</span> ×”×©×•×•××ª ×©×‘×¨×™×</div><div class="wizard-content"><p>×©×™×˜×ª ×”×›×¤×œ ×‘×”×¦×œ×‘×”: ×›×¤×•×œ ××•× ×” ×‘×¦×“ ××—×“ ×‘××›× ×” ×©×œ ×”×©× ×™. ×”×’×“×•×œ ×× ×¦×—!</p></div></div>`,
            "E_SORT_4": `<div class="wizard-section"><div class="wizard-title"><span class="text-2xl">ğŸ”¤</span> ×—×œ×§×™ ×”×“×™×‘×•×¨</div><div class="wizard-content"><ul class="list-disc pr-5"><li><strong>Verb:</strong> ×¤×¢×•×œ×” (Eat, Run).</li><li><strong>Adjective:</strong> ×ª×™××•×¨ (Blue, Fast).</li></ul></div></div>`,
            "E_TOBE": `<div class="wizard-section"><div class="wizard-title"><span class="text-2xl">ğŸ‘¤</span> To Be</div><div class="wizard-content"><ul class="list-disc pr-5"><li><strong>Am:</strong> ×¢× I.</li><li><strong>Is:</strong> ×¢× ×™×—×™×“ (He, She, It).</li><li><strong>Are:</strong> ×¢× ×¨×‘×™× (We, They).</li></ul></div></div>`,
            "E_READ": `<div class="wizard-section"><div class="wizard-title"><span class="text-2xl">ğŸ“–</span> ×”×‘× ×ª ×”× ×§×¨×</div><div class="wizard-content"><p>×—×¤×© ××ª ××™×œ×ª ×”××¤×ª×— ×‘×˜×§×¡×˜. ×”×ª×©×•×‘×” ×œ×™×“×”!</p></div></div>`
        };

        function showContextualHelp() {
            if (!document.getElementById('game-view').classList.contains('hidden') && gameState.historyIndex >= 0) {
                const currentQ = gameState.history[gameState.historyIndex]?.data;
                if (currentQ) {
                     const hintHTML = HINTS[currentQ.type] || "<p>××™×Ÿ ×¨××– ×–××™×Ÿ.</p>";
                     document.getElementById('tips-content').innerHTML = hintHTML;
                     document.getElementById('tips-modal').classList.remove('hidden');
                     return;
                }
            }
            showTips(); 
        }

        function formatQuestionText(text) {
            return text.replace(/\{(\w+)\}/g, (match, key) => {
                const url = ITEM_ICONS[key.toLowerCase()];
                if (url) return `<img src="${url}" class="inline-icon" alt="${key}">`;
                return match; 
            });
        }

        const MUSIC = document.getElementById('bg-music');
        let musicPlaying = false;
        let envInterval; let isNight = false;
        
        function initEnvironment() {
            const starsContainer = document.getElementById('stars-container');
            for(let i=0; i<50; i++) {
                const star = document.createElement('div'); star.className = 'star';
                star.style.top = Math.random()*50+'%'; star.style.left = Math.random()*100+'%';
                star.style.animationDelay = Math.random()*2+'s'; starsContainer.appendChild(star);
            }
            const rainContainer = document.getElementById('rain-container');
            for(let i=0; i<50; i++) {
                const drop = document.createElement('div'); drop.className = 'rain-drop';
                drop.style.left = Math.random()*100+'%';
                drop.style.animationDuration = (0.5+Math.random()*0.3)+'s';
                rainContainer.appendChild(drop);
            }
            if(envInterval) clearInterval(envInterval);
            envInterval = setInterval(cycleEnvironment, 30000); // ×”×’×“×œ×” ×œ-30 ×©× ×™×•×ª
            setInterval(spawnScenery, 3000);
        }

        function cycleEnvironment() {
            const world = document.getElementById('world-layer');
            const sun = document.querySelector('.sun'); const moon = document.querySelector('.moon');
            isNight = !isNight;
            if(isNight) { world.classList.add('night'); sun.style.top="110%"; moon.style.top="15%"; } 
            else { world.classList.remove('night'); sun.style.top="10%"; moon.style.top="110%"; }
            if(Math.random()>0.7) {
                const weatherType = Math.random();
                world.classList.remove('raining', 'storm');
                if(weatherType>0.6) { world.classList.add('raining', 'storm'); triggerLightning(); }
                else if (weatherType>0.3) { world.classList.add('raining'); }
            } else { world.classList.remove('raining', 'storm'); }
        }

        function triggerLightning() {
            const flash = document.querySelector('.lightning-flash'); const thunder = document.getElementById('sfx-thunder');
            flash.style.animation = 'none'; flash.offsetHeight; flash.style.animation = "flashLightning 1s forwards";
            thunder.currentTime = 0; thunder.play().catch(()=>{});
        }
        
        function spawnScenery() {
            const container = document.getElementById('scenery-layer');
            if(!container || document.hidden) return;
            const tower = document.createElement('div'); tower.className = 'tower-stack';
            tower.style.left = Math.random()*100+'%';
            const height = Math.floor(Math.random()*4)+2;
            for(let i=0; i<height; i++) {
                const block = document.createElement('div'); block.className = 'tower-block';
                tower.appendChild(block);
            }
            container.appendChild(tower);
            setTimeout(() => { if(tower.parentNode) tower.parentNode.removeChild(tower); }, 10000);
        }

        function playIntro() {
            document.getElementById('start-btn-container').classList.add('hidden');
            const introAnim = document.getElementById('intro-animation'); const introTitle = document.getElementById('intro-title');
            introAnim.classList.remove('hidden'); document.getElementById('scary-enderman').classList.add('intro-running');
            document.getElementById('sfx-thunder').play().catch(()=>{});
            document.querySelector('.lightning-flash').style.animation = "flashLightning 3s forwards";
            setTimeout(() => { introAnim.classList.add('hidden'); introTitle.classList.remove('hidden'); }, 2500);
            setTimeout(() => {
                document.getElementById('cinematic-overlay').classList.add('hidden');
                introTitle.classList.add('hidden'); document.getElementById('main-interface').classList.remove('hidden');
                initEnvironment();
            }, 5500);
        }

        window.toggleMusic = () => {
            if(musicPlaying) { MUSIC.pause(); document.getElementById('music-btn').textContent="ğŸµ × ×’×Ÿ"; }
            else { MUSIC.play().catch(()=>{}); document.getElementById('music-btn').textContent="ğŸ”‡ ×”×©×ª×§"; }
            musicPlaying = !musicPlaying;
        };

        window.showHome = () => { 
            showView('intro-view'); gameState.missionId=0; gameState.history=[]; gameState.errors=[]; gameState.isReview=false; updateUI(); 
        };
        window.startGame = () => { if(!musicPlaying) toggleMusic(); showView('subject-menu-view'); };
        window.showView = (id) => { document.querySelectorAll('.view').forEach(v => v.classList.add('hidden')); document.getElementById(id).classList.remove('hidden'); };
        window.showMathMenu = () => showView('math-menu-view');
        window.showEnglishMenu = () => showView('english-menu-view');
        window.showTips = () => {
            let allHints = ""; for (const key in HINTS) allHints += HINTS[key];
            document.getElementById('tips-content').innerHTML = allHints; document.getElementById('tips-modal').classList.remove('hidden');
        };
        window.hideTips = () => document.getElementById('tips-modal').classList.add('hidden');
        window.showAdminPanel = () => document.getElementById('admin-panel-modal').classList.remove('hidden');
        window.hideAdminPanel = () => document.getElementById('admin-panel-modal').classList.add('hidden');

        window.loadCustomQuestions = () => {
            try {
                const newQs = JSON.parse(document.getElementById('json-input').value);
                newQs.forEach(q => { if(q.missionId) (q.missionId < 100 ? mathQ : engQ)[q.missionId]?.push(q); });
                document.getElementById('admin-feedback').innerText = "Loaded!";
            } catch(e) { document.getElementById('admin-feedback').innerText = "Error"; }
        };
        window.clearCustomQuestions = () => { if(confirm("Reset?")) location.reload(); };
        window.changeDifficulty = () => gameState.difficulty = document.getElementById('difficulty-select').value;
        
        window.startMission = (id) => {
            gameState.missionId = id; gameState.history = []; gameState.historyIndex = -1; gameState.isReview = false;
            let pool = (id < 100) ? mathQ[id] : engQ[id];
            let fullPool = pool ? [...pool] : [];
            while (fullPool.length < MAX_QUESTIONS && fullPool.length > 0) fullPool = fullPool.concat(pool);
            gameState.questionQueue = fullPool.sort(() => Math.random() - 0.5);
            showView('game-view'); window.nextQ();
        };

        window.startReview = () => {
            if (gameState.errors.length === 0) return;
            const reviewQs = [...gameState.errors]; gameState.history = []; gameState.errors = []; gameState.historyIndex = -1; gameState.isReview = true;
            reviewQs.forEach(q => gameState.history.push({ data: q, solved: false, tries: 0 }));
            showView('game-view'); window.nextQ();
        };

        function goToNextMission() {
            let nextId = gameState.missionId + 1;
            if (mathQ[nextId] || engQ[nextId]) startMission(nextId);
            else { alert("×¡×™×™××ª ××ª ×›×œ ×”××©×™××•×ª!"); showHome(); }
        }

        window.exitMission = () => {
            showView('summary-view');
            const total = gameState.history.length;
            let grade = total > 0 ? Math.round((gameState.missionScore / (total * 10)) * 100) : 0;
            document.getElementById('final-score').textContent = gameState.score;
            document.getElementById('final-grade').textContent = grade + "%";
            document.getElementById('final-diamonds').textContent = gameState.diamonds;
            const tbody = document.getElementById('error-log-body'); tbody.innerHTML = '';
            
            const nextId = gameState.missionId + 1;
            const hasNext = (mathQ[nextId] || engQ[nextId]);
            
            if(gameState.errors.length === 0) {
                document.getElementById('no-errors-text').classList.remove('hidden');
                document.getElementById('retake-section').classList.add('hidden');
                if (hasNext) document.getElementById('next-level-container').classList.remove('hidden');
                else document.getElementById('next-level-container').classList.add('hidden');
            } else {
                document.getElementById('no-errors-text').classList.add('hidden');
                document.getElementById('retake-section').classList.remove('hidden');
                document.getElementById('next-level-container').classList.add('hidden');
                gameState.errors.forEach(q => { 
                    let ansDisplay = q.ans || (q.type === 'M_WORD' ? (q.ansD === 1 ? q.ansN : `${q.ansN}/${q.ansD}`) : `${q.n}/${q.d}`);
                    if (ANSWER_DISPLAY_MAP[q.ans]) ansDisplay = ANSWER_DISPLAY_MAP[q.ans];
                    tbody.innerHTML += `<tr><td>${formatQuestionText(q.q)}</td><td dir="ltr" class="text-right">${ansDisplay}</td></tr>`; 
                });
            }
        };

        window.nextQ = () => {
            if(gameState.historyIndex < gameState.history.length - 1) { gameState.historyIndex++; renderQ(); updateUI(); } 
            else { generateQ(); }
            resetFeedback();
        };
        window.prevQ = () => { if(gameState.historyIndex > 0) { gameState.historyIndex--; renderQ(); updateUI(); resetFeedback(); } };
        
        window.skipQ = () => { 
            if (!gameState.isReview) {
                 const currItem = gameState.history[gameState.historyIndex];
                 if (!currItem.solved && !gameState.errors.includes(currItem.data)) gameState.errors.push(currItem.data);
                 if (gameState.history.length >= MAX_QUESTIONS) { exitMission(); return; }
            }
            window.nextQ();
        }

        function generateQ() {
            if (gameState.isReview || gameState.history.length >= MAX_QUESTIONS || gameState.questionQueue.length === 0) { exitMission(); return; }
            const qData = gameState.questionQueue.pop();
            gameState.history.push({ data: qData, solved: false, tries: 0 });
            gameState.historyIndex = gameState.history.length - 1; renderQ(); updateUI();
        }

        function renderQ() {
            const q = gameState.history[gameState.historyIndex].data;
            document.getElementById('question-text').innerHTML = formatQuestionText(q.q);
            const box = document.getElementById('game-content'); box.innerHTML = '';
            document.getElementById('check-btn').style.display = 'inline-block';

            if(q.type === 'M_ID' || q.type === 'M_WORD') {
                box.innerHTML = `
                    <div class="flex flex-col md:flex-row items-center justify-center gap-6 w-full">
                         ${q.type === 'M_ID' ? `<div id="visual-container" class="flex flex-col items-center gap-2 w-full"></div>` : ''}
                        <div class="mc-slot flex flex-col items-center bg-gray-800 p-4 border-4 border-gray-600">
                            <label class="text-xs text-gray-400 mb-1">××•× ×” (×—×œ×§)</label>
                            <input id="in-n" type="number" class="mc-input w-20 mb-2" placeholder="?">
                            <div class="fraction-divider w-20 h-1 bg-white"></div>
                            <input id="in-d" type="number" class="mc-input w-20 mt-2" placeholder="?" value="${q.type === 'M_WORD' ? '1' : ''}">
                            <label class="text-xs text-gray-400 mt-1">××›× ×” (×©×œ×)</label>
                        </div>
                    </div>`;
                if(q.type === 'M_ID') drawVisuals(q.n, q.d, q.theme || 'grass');
            } 
            else if(q.type === 'M_SORT') {
                box.innerHTML = `
                    <div class="text-5xl text-white mb-4 font-bold text-center drop-shadow-md" dir="ltr">${q.n}/${q.d}</div>
                    <div class="flex gap-4 justify-center flex-wrap">
                        <button onclick="check('proper')" class="btn-mc btn-stone text-sm">×§×˜×Ÿ ×-1 (Stack)</button>
                        <button onclick="check('improper')" class="btn-mc btn-stone text-sm">×’×“×•×œ/×©×•×•×” ×œ-1</button>
                    </div>`;
                document.getElementById('check-btn').style.display = 'none';
            }
            else if(q.type === 'M_CMP') {
                box.innerHTML = `
                    <div class="flex items-center gap-4 text-2xl font-bold">
                         <div dir="ltr" class="bg-gray-700 p-2 border-2 border-black">${q.n1}/${q.d1}</div>
                         <div class="flex flex-col gap-2">
                            <button onclick="check('<')" class="btn-mc btn-stone text-xl">&lt;</button>
                            <button onclick="check('=')" class="btn-mc btn-stone text-xl">=</button>
                            <button onclick="check('>')" class="btn-mc btn-stone text-xl">&gt;</button>
                         </div>
                         <div dir="ltr" class="bg-gray-700 p-2 border-2 border-black">${q.n2}/${q.d2}</div>
                    </div>`;
                document.getElementById('check-btn').style.display = 'none';
            }
            else if(q.type === 'E_SORT_4') {
                box.innerHTML = `
                    <div class="grid grid-cols-2 gap-4 w-full max-w-md">
                        <button onclick="check('verb')" class="btn-mc btn-redstone text-sm">Verb (×¤×•×¢×œ)</button>
                        <button onclick="check('adj')" class="btn-mc btn-diamond text-sm">Adjective (×ª×•××¨)</button>
                        <button onclick="check('calendar')" class="btn-mc btn-gold text-sm">Calendar (×–××Ÿ)</button>
                        <button onclick="check('number')" class="btn-mc btn-stone text-sm">Number (××¡×¤×¨)</button>
                    </div>`;
                document.getElementById('check-btn').style.display = 'none';
            }
            else if(q.type === 'E_TOBE') {
                box.innerHTML = `<div class="flex gap-4 justify-center flex-wrap"><button onclick="check('am')" class="btn-mc btn-wood text-xl">am</button><button onclick="check('is')" class="btn-mc btn-wood text-xl">is</button><button onclick="check('are')" class="btn-mc btn-wood text-xl">are</button></div>`;
                document.getElementById('check-btn').style.display = 'none';
            }
            else if(q.type === 'E_READ') {
                 box.innerHTML = `<input id="in-text" type="text" class="mc-input w-64" placeholder="×ª×©×•×‘×” ×‘×× ×’×œ×™×ª...">`;
            }
        }

        function drawVisuals(n, d, theme) {
            setTimeout(() => {
                const container = document.getElementById('visual-container');
                if(!container) return; container.innerHTML = ''; if (d > 20) return; 
                const row = document.createElement('div'); row.className = 'block-row';
                const blockUrl = THEME_BLOCKS[theme] || THEME_BLOCKS['grass'];
                for(let i=0; i<d; i++) {
                    const img = document.createElement('img'); img.src = blockUrl; img.className = 'mc-block-img';
                    if (i >= n) img.classList.add('mc-block-ghost');
                    row.appendChild(img);
                }
                container.appendChild(row);
                const pie = document.createElement('div'); pie.className = 'pie-chart';
                const deg = (n / d) * 360;
                const colors = { grass: "#4A8F28", stone: "#7D7D7D", diamond: "#3C8DAB", gold: "#F0A804", iron: "#E6E6E6", tnt: "#DB2E23", wood: "#8F6942", emerald: "#17DD62", coal: "#333", cake: "#FFF" };
                const themeColor = colors[theme] || '#4A8F28';
                pie.style.background = `conic-gradient(${themeColor} 0deg ${deg}deg, #222 ${deg}deg 360deg)`;
                pie.style.marginTop = "10px";
                const sliceDeg = 360 / d;
                const overlay = document.createElement('div'); overlay.style.position = 'absolute'; overlay.style.top = '0'; overlay.style.left = '0'; overlay.style.width = '100%'; overlay.style.height = '100%'; overlay.style.borderRadius = '50%';
                overlay.style.backgroundImage = `repeating-conic-gradient(transparent 0deg ${sliceDeg - 2}deg, rgba(255,255,255,0.3) ${sliceDeg - 2}deg ${sliceDeg}deg)`;
                pie.appendChild(overlay); container.appendChild(pie);
            }, 0);
        }

        window.checkAnswer = check = (val) => {
            const item = gameState.history[gameState.historyIndex]; if(item.solved) return;
            const q = item.data; let correct = false;

            if(q.type === 'M_ID' || q.type === 'M_WORD') {
                const n = parseInt(document.getElementById('in-n').value); const d = parseInt(document.getElementById('in-d').value);
                correct = (q.type === 'M_WORD') ? ((n === q.ansN && d === q.ansD) || (q.ansD === 8 && n === q.ansN && d === 1)) : (n === q.n && d === q.d);
            } else if (q.type.includes('SORT') || q.type === 'M_CMP' || q.type === 'E_TOBE') {
                correct = (val === q.ans);
                if (q.type === 'E_TOBE') document.getElementById('question-text').innerHTML = document.getElementById('question-text').innerHTML.replace('___', `<span class="filled-answer ${correct ? "filled-correct" : "filled-wrong"}">${val}</span>`);
            } else if (q.type === 'E_READ') {
                correct = document.getElementById('in-text').value.trim().toLowerCase().includes(q.ans.toLowerCase());
            }

            const fb = document.getElementById('feedback'); 
            fb.classList.remove('hidden');
            
            if(correct) {
                gameState.score += 10; gameState.missionScore += 10; gameState.diamonds++;
                item.solved = true; updateUI(); 
                fb.innerHTML = "× ×›×•×Ÿ ×××•×“! ğŸ’";
                fb.className = "mt-4 p-3 border-2 border-white text-center font-bold text-lg flex-shrink-0 bg-green-600 text-white shadow-md rounded";
                document.getElementById('check-btn').style.display = 'none'; 
                const skipBtn = document.getElementById('skip-btn'); skipBtn.textContent = "×”×©××œ×” ×”×‘××” â¡"; skipBtn.classList.remove('btn-gold'); skipBtn.classList.add('btn-grass');
            } else {
                item.tries++; 
                fb.innerHTML = "××•×¤×¡! × ×¡×” ×©×•×‘ ğŸ§Ÿ";
                fb.className = "mt-4 p-3 border-2 border-white text-center font-bold text-lg flex-shrink-0 bg-orange-500 text-white shadow-md rounded";
                if(item.tries === 1 && !gameState.errors.includes(q)) gameState.errors.push(q);
            }
        };

        function resetFeedback() {
            document.getElementById('feedback').classList.add('hidden'); document.getElementById('check-btn').disabled = false;
            document.getElementById('check-btn').style.display = 'inline-block';
            const skipBtn = document.getElementById('skip-btn'); skipBtn.textContent = "×“×œ×’ â©"; skipBtn.classList.remove('btn-grass'); skipBtn.classList.add('btn-gold');
            if(gameState.history[gameState.historyIndex].solved) {
                document.getElementById('check-btn').style.display = 'none'; document.getElementById('feedback').innerHTML = "×›×‘×¨ × ×¤×ª×¨!"; document.getElementById('feedback').classList.remove('hidden');
                skipBtn.textContent = "×”×©××œ×” ×”×‘××” â¡"; skipBtn.classList.remove('btn-gold'); skipBtn.classList.add('btn-grass');
            }
        }
        
        function updateUI() {
            document.getElementById('score-display').textContent = gameState.score; document.getElementById('diamonds-display').textContent = gameState.diamonds;
            const current = gameState.historyIndex + 1; const total = gameState.isReview ? gameState.history.length : MAX_QUESTIONS;
            document.getElementById('q-num').textContent = `${current} / ${total}`;
            document.getElementById('progress-fill').style.width = `${Math.min(100, Math.round((current / total) * 100))}%`;
        }

        // --- DATA POOLS ---
        let mathQ = {
            1: [
                {q:"×‘×ª×™×‘×” ×™×© 5 ×›×œ×™×. 2 ×”× {pickaxe_iron}. ×™×™×¦×’ ××ª ×”×—×œ×§ ×©×œ ××›×•×© ×”×‘×¨×–×œ:", n:2, d:5, type:"M_ID", theme: "pickaxe"},
                {q:"×™×™×¦×’ ××ª ×”×—×œ×§ ×©×œ ×”-{sword_diamond} ××ª×•×š ×”×¡×š ×”×›×œ (4):", n:3, d:4, type:"M_ID", theme: "diamond"},
                {q:"×—×¦×™ ××”×‘×œ×•×§×™× ×”× {planks_oak}. ×™×™×¦×’ ××ª ×”×©×‘×¨:", n:1, d:2, type:"M_ID", theme: "planks_oak"},
                {q:"××¡×¤×ª 3 ××ª×•×š 7 {ore_gold}. ×›×ª×•×‘ ××ª ×”×©×‘×¨:", n:3, d:7, type:"M_ID", theme: "ore_gold"},
                {q:"×”××•× ×” ×”×•× 3 {emerald}, ×”××›× ×” ×”×•× 4. ××”×• ×”×©×‘×¨?", n:3, d:4, type:"M_ID", theme: "emerald"},
                {q:"×™×™×¦×’ ××ª ×”×—×œ×§ ×©×œ ×”-{tnt} (××ª×•×š 8 ×‘×œ×•×§×™×):", n:3, d:8, type:"M_ID", theme: "tnt"},
                {q:"×™×© ×œ×š 6 {bread}. ××›×œ×ª 4. ××”×• ×”×©×‘×¨?", n:4, d:6, type:"M_ID", theme: "bread"},
                {q:"×”××•× ×” ×”×•× 2 {bucket_water}, ×”××›× ×” ×”×•× 3.", n:2, d:3, type:"M_ID", theme: "bucket_water"},
                {q:"××¡×¤×ª 5 {cookie} ××ª×•×š 8. ×›×ª×•×‘ ××ª ×”×©×‘×¨:", n:5, d:8, type:"M_ID", theme: "cookie"},
                {q:"×“×’×ª 10 {fish}. 3 ×‘×¨×—×•. ××™×–×” ×—×œ×§ × ×©××¨?", n:7, d:10, type:"M_ID", theme: "fish"},
                {q:"×‘×©×‘×™×œ ×¢×•×’×” ×¦×¨×™×š 3 {bucket_milk}. ×™×© ×œ×š 1. ××™×–×” ×—×œ×§ ×™×© ×œ×š?", n:1, d:3, type:"M_ID", theme: "bucket_milk"},
                {q:"×‘×™×©×œ×ª 4 {cooked_porkchop} ××ª×•×š 5. ××” ×”×©×‘×¨?", n:4, d:5, type:"M_ID", theme: "cooked_porkchop"},
                {q:"×œ××¢×“×¨ {hoe_wood} ×™×© 50 ×©×™××•×©×™×. ×”×©×ª××©×ª ×‘-1/5. ×›××” × ×•×ª×¨×•?", n:40, d:1, type:"M_WORD", theme: "hoe"},
                {q:"×‘×ª×™×‘×” 4 ×›×œ×™×. 1 ××”× ×”×•× {pickaxe_diamond}. ××” ×”×—×œ×§?", n:1, d:4, type:"M_ID", theme: "pickaxe"},
                {q:"×›××” ×–×” ×—×¦×™ ×-10 {clock}?", n:5, d:1, type:"M_WORD", theme: "clock"}
            ],
            2: [
                {q: "×”×× 5/2 ({sword_gold}) ×”×•× ×©×‘×¨ ×’×“×•×œ ×-1?", ans: "improper", n:5, d:2, type:"M_SORT", theme: "gold"},
                {q: "×”×× 10/12 ({apple}) ×”×•× ×©×‘×¨ ×§×˜×Ÿ ×-1?", ans: "proper", n:10, d:12, type:"M_SORT"},
                {q: "×”×× 7/7 ({chestplate_iron}) × ×—×©×‘ ×’×“×•×œ/×©×•×•×” ×œ-1?", ans: "improper", n:7, d:7, type:"M_SORT"},
                {q: "××™×™×Ÿ: 4/3 {bucket_lava}", ans: "improper", n:4, d:3, type:"M_SORT", theme: "bucket_lava"},
                {q: "××™×™×Ÿ: 1/4 ××¤×”", ans: "proper", n:1, d:4, type:"M_SORT"},
                {q: "×”×× 8/5 {porkchop} ×–×” ×™×•×ª×¨ ×-1?", ans: "improper", n:8, d:5, type:"M_SORT", theme: "porkchop"}
            ],
            3: [
                {q: "×—×™×‘×•×¨: 2/9 {emerald} + 5/9 {emerald} + ? = 10/9", n:3, d:9, type:"M_ID", theme: "emerald"}, 
                {q: "×‘×™×©×•×œ: 3/5 {coal} + 4/5 {coal} = ?", n:7, d:5, type:"M_ID", theme: "coal"},
                {q: "×¡×˜×™×‘ ××›×œ 2/8 ××”-{cake}, ××œ×›×¡ 1/8. ×›××” ×™×—×“?", n:3, d:8, type:"M_ID", theme: "cake"},
                {q: "Crafting: 2/6 {redstone} + 3/6 {redstone} = ?", n:5, d:6, type:"M_ID", theme: "redstone"}
            ],
            4: [
                {q: "××” ×©×•×•×” ×™×•×ª×¨? 1/7 {diamond} ××•×œ 1/5", n1:1, d1:7, n2:1, d2:5, ans:"<", type:"M_CMP"},
                {q: "××™ ×—×–×§ ×™×•×ª×¨? 4/3 {axe_iron} ××•×œ 3/4", n1:4, d1:3, n2:3, d2:4, ans:">", type:"M_CMP"},
                {q: "×”×©×•×•×” ××œ××™: 3/4 ××•×œ 3/5", n1:3, d1:4, n2:3, d2:5, ans:">", type:"M_CMP"},
                {q: "×”×©×•×•×”: 2/7 ××•×œ 4/9", n1:2, d1:7, n2:4, d2:9, ans:"<", type:"M_CMP"},
                {q: "×”×× 2/6 {gold} ×©×•×•×” ×œ-1/3?", n1:2, d1:6, n2:1, d2:3, ans:"=", type:"M_CMP"}
            ],
            5: [
                {q: "×‘×¡×¤×¨×™×™×” ×™×© 3 ××“×¤×™×. ×‘×××¦×¢×™ 12 ×¡×¤×¨×™×. ×‘×¢×œ×™×•×Ÿ 2/3 ××”×××¦×¢×™. ×›××” ×¡×¤×¨×™× ×‘×¢×œ×™×•×Ÿ?", ansN:8, ansD:1, type:"M_WORD"},
                {q: "×‘×ª×™×‘×” 20 ×‘×œ×•×§×™×. 3/10 ×”× {emerald}. ×›××” ×××¨×œ×“×™×?", ansN:6, ansD:1, type:"M_WORD"},
                {q: "×‘×ª×™×‘×” 20 ×‘×œ×•×§×™×. 3/10 ×”× {wood} ×•×”×©××¨ {stone}. ×›××” ××‘× ×™×?", ansN:14, ansD:1, type:"M_WORD"},
                {q: "{cake} ××—×•×œ×§×ª ×œ-8. ×¡×˜×™×‘ ××›×œ 2, ××œ×›×¡ 1. ×›××” × ×©××¨?", ansN:5, ansD:1, type:"M_WORD"},
                {q: "×™×© ×œ×š 9 {carrot}. × ×ª×ª 1/3 ×œ×—×–×™×¨. ×›××” × ×ª×ª?", ansN:3, ansD:1, type:"M_WORD", theme: "carrot"},
                {q: "××œ×›×¡ ××¦××” 12 {melon}. ×”×™× ××›×œ×” 1/4. ×›××” ××›×œ×”?", ansN:3, ansD:1, type:"M_WORD", theme: "melon"}
            ]
        };

        let engQ = {
            101: [
                {q: "{crafting} Craft (×œ×™×¦×•×¨)", ans: "verb", type:"E_SORT_4"},
                {q: "Twenty {diamond}s", ans: "number", type:"E_SORT_4"},
                {q: "May (Month)", ans: "calendar", type:"E_SORT_4"},
                {q: "Strong ({chestplate_diamond})", ans: "adj", type:"E_SORT_4"},
                {q: "Thirty {creeper}s", ans: "number", type:"E_SORT_4"},
                {q: "Tall ({enderman})", ans: "adj", type:"E_SORT_4"},
                {q: "Climb ({ladder})", ans: "verb", type:"E_SORT_4"},
                {q: "August", ans: "calendar", type:"E_SORT_4"},
                {q: "Give ({apple})", ans: "verb", type:"E_SORT_4"},
                {q: "Fast ({potion})", ans: "adj", type:"E_SORT_4"},
                {q: "Eat ({bread})", ans: "verb", type:"E_SORT_4"},
                {q: "Shoot ({bow})", ans: "verb", type:"E_SORT_4"},
                {q: "Sweet ({cookie})", ans: "adj", type:"E_SORT_4"},
                {q: "Hot ({bucket_lava})", ans: "adj", type:"E_SORT_4"},
                {q: "Twelve {arrow}s", ans: "number", type:"E_SORT_4"},
                {q: "Catch a {fish}", ans: "verb", type:"E_SORT_4"},
                {q: "Drink {bucket_milk}", ans: "verb", type:"E_SORT_4"},
                {q: "Tasty {cooked_porkchop}", ans: "adj", type:"E_SORT_4"},
                {q: "Use a {pickaxe_diamond} to mine", ans: "verb", type:"E_SORT_4"},
                {q: "Dig with a {shovel_iron}", ans: "verb", type:"E_SORT_4"},
                {q: "Find north with a {compass}", ans: "verb", type:"E_SORT_4"},
                {q: "Check time on the {clock}", ans: "verb", type:"E_SORT_4"},
                {q: "Farm with a {hoe_stone}", ans: "verb", type:"E_SORT_4"}
            ],
            102: [
                {q: "Steve ___ mining now.", ans: "is", type:"E_TOBE"},
                {q: "I ___ a builder.", ans: "am", type:"E_TOBE"},
                {q: "They ___ playing on the server.", ans: "are", type:"E_TOBE"},
                {q: "You ___ a griefer!", ans: "are", type:"E_TOBE"},
                {q: "The {zombie} ___ in the cave.", ans: "is", type:"E_TOBE"},
                {q: "She ___ crafting a {sword_iron}.", ans: "is", type:"E_TOBE"}
            ],
            103: [
                {q: "How old is Steve? (Text says 10)", ans: "10", type:"E_READ"},
                {q: "Steve's birthday is in which month? (June)", ans: "june", type:"E_READ"},
                {q: "What is Steve's hobby? (Building)", ans: "building", type:"E_READ"},
                {q: "Who is Steve's best friend? (Alex)", ans: "alex", type:"E_READ"},
                {q: "Alex likes to play ___.", ans: "spleef", type:"E_READ"} 
            ]
        };
    </script>
</body>
</html>